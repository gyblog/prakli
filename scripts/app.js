!function(){"use strict";angular.module("prakli",["ui.router","ngMaterial","ngAnimate","ngCookies","nvd3"])}(),function(){"use strict";function e(e,n){n.otherwise("/"),e.state("login",{url:"/login",templateUrl:t+"/login/login.html",controller:"LoginController",controllerAs:"_login"}).state("home",{url:"/",templateUrl:t+"/user/sidenav.html",controller:"UserController",controllerAs:"_user"}).state("home.dashboard",{url:"dashboard",views:{content:{templateUrl:t+"/dashboard/dashboard.html",controller:"DashboardController",controllerAs:"_dash"}}}).state("home.projects",{url:"projects",views:{content:{templateUrl:t+"/projects/list.html",controller:"ProjectsController",controllerAs:"_projects"}}}).state("home.singleProject",{url:"projects/:projectID",views:{content:{templateUrl:t+"/projects/singleProject.html",controller:"SingleProjectController",controllerAs:"_singleProject"}}}).state("home.tasks",{url:"tasks",views:{content:{templateUrl:t+"/tasks/list.html",controller:"tasksController",controllerAs:"_tasks"}}}).state("home.singleTask",{url:"projects/:projectID/task/:taskID",views:{content:{templateUrl:t+"/tasks/singleTask.html",controller:"SingleTaskController",controllerAs:"_singleTask"}}}).state("home.messages",{url:"messages",views:{content:{templateUrl:t+"/messages/list.html",controller:"MessagesController",controllerAs:"_messages"}}}).state("home.settings",{url:"settings",views:{content:{templateUrl:t+"/settings/settings.html",controller:"SettingsController",controllerAs:"_settings"}}})}var t="./scripts";angular.module("prakli").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){function e(e,t){t.firstDyOfWeek=1,t.formatDate=function(e){return moment(e).format("YYYY-MM-DD")},e.definePalette("ka-blue",{50:"96c5fd",100:"4a9bfc",200:"137dfc",300:"035bc4",400:"024da6",500:"023f88",600:"02316a",700:"01234c",800:"01152d",900:"00070f",A100:"96c5fd",A200:"4a9bfc",A400:"024da6",A700:"01234c",contrastDefaultColor:"light",contrastDarkColors:"50 100 A100 A200"}),e.definePalette("kaGrey",{50:"ffffff",100:"e0e1e1",200:"c4c5c6",300:"9fa1a3",400:"909194",500:"808285",600:"717375",700:"626366",800:"535456",900:"444547",A100:"ffffff",A200:"e0e1e1",A400:"909194",A700:"626366",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 A100 A200 A400"}),e.definePalette("kaLightGrey",{50:"ffffff",100:"ffffff",200:"ffffff",300:"ffffff",400:"f5f6f7",500:"e4e6e9",600:"d3d6db",700:"c2c7ce",800:"b1b7c0",900:"a1a8b2",A100:"ffffff",A200:"ffffff",A400:"f5f6f7",A700:"c2c7ce",contrastDefaultColor:"light",contrastDarkColors:"50 100 200 300 400 500 600 700 800 900 A100 A200 A400 A700"});var n=["ka-blue","kaGrey","kaLightGrey","pink","purple","indigo","light-blue","green","light-green","yellow","amber","orange","red","brown"];angular.forEach(n,function(t,n){e.theme(t).primaryPalette(t).accentPalette("red").warnPalette("deep-orange")}),e.theme("default").primaryPalette("ka-blue")}angular.module("prakli").config(e),e.$inject=["$mdThemingProvider","$mdDateLocaleProvider"]}(),function(){"use strickt";function e(e,t,n,a,s){var r="hu";if(a.lng=[],e.getObject("user")){var o="";if(e.get("redir"))o=e.get("redir"),e.remove("redir");else{var l=t.path();o="/"!=l&&"/login"!=l?l:"/dashboard"}r=e.getObject("user").defaultlang,s.getLanguage(r).then(function(e){a.lng=e}),t.path(o)}else s.getLanguage(r).then(function(e){a.lng=e}),"/"!=t.path()&&"/login"!=t.path()&&e.put("redir",t.path()),t.path("/login")}angular.module("prakli").run(e),e.$inject=["$cookies","$location","$state","$rootScope","lng"]}(),function(){"use strict";function e(e){function t(t){return e.get("api/"+t+".json").then(n)["catch"](a)}function n(e){return e.data}function a(e){console.log("XHR Failed for Language! ERROR:"),console.log(e.data)}this.getLanguage=t}angular.module("prakli").service("lng",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(){function t(e){return e.data}function n(e){console.log("XHR failed for USERS! ERROR: "),console.log(e.data)}return e.get("api/api.php/users").then(t)["catch"](n)}function n(t){function n(e){return e.data}function a(e,t){console.log("XHR failed for USER `"+t+"`! ERROR: "),console.log(e.data)}return e.get("api/api.php/users/"+t).then(n)["catch"](a)}function a(t){function n(e){return e.data}function a(e){console.log("XHR Failed PUT for Users! ERROR:"),console.log(e.data)}var s={method:"PUT",url:"api/api.php/users/"+t.username,data:t,headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}};return e(s).then(n)["catch"](a)}var s={getList:t,get:n,update:a};return s}angular.module("prakli").factory("Users",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(t){function n(e){return e.data}function a(e){console.log("XHR Failed PUT for Project! ERROR:"),console.log(e.data)}var s={method:"PUT",url:"api/api.php/projects",data:t,headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}};return e(s).then(n)["catch"](a)}function n(t){function n(e){return e.data}function a(e){console.log("XHR Failed POST for TASK! ERROR:"),console.log(e.data)}var s={method:"POST",url:"api/api.php/projects/"+t.id+"/task",data:t,headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}};return e(s).then(n)["catch"](a)}function a(t){function n(e){return e.data}function a(e){console.log("XHR Failed POST for PROJECT! ERROR:"),console.log(e.data)}var s={method:"POST",url:"api/api.php/projects",data:t,headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}};return e(s).then(n)["catch"](a)}function s(t){function n(e){return e.data}function a(e){console.log("XHR Failed for PROJECTS! ERROR:"),console.log(e.data)}return e.get("api/api.php/projects/"+t).then(n)["catch"](a)}function r(t){function n(e){return e.data}function a(e){console.log("XHR Failed for PROJECTS! ERROR:"),console.log(e.data)}return e.get("api/api.php/projects/"+t).then(n)["catch"](a)}var o={getMyProjects:s,getProject:r,insert:a,addTask:n,save:t};return o}angular.module("prakli").factory("Projects",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(t){function n(e){return e.data}function a(e){console.log("XHR Failed for MESSAGE! ERROR:"),console.log(e.data)}return e.get("api/api.php/messages/"+t).then(n)["catch"](a)}function n(t){function n(e){return e.data}function a(e){console.log("XHR Failed DELETE for MESSAGE! ERROR:"),console.log(e.data)}var s={method:"DELETE",url:"api/api.php/messages/"+t,headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}};return e(s).then(n)["catch"](a)}function a(t){function n(e){return e.data}function a(e){console.log("XHR Failed POST for MESSAGE! ERROR:"),console.log(e.data)}var s={method:"POST",url:"api/api.php/messages",data:t,headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}};return e(s).then(n)["catch"](a)}var s={insert:a,getMyMessages:t,"delete":n};return s}angular.module("prakli").factory("Messages",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){function t(){function t(e){return e.data}function n(e){console.log("XHR failed for TYPES! ERROR: "),console.log(e.data)}return e.get("api/api.php/types").then(t)["catch"](n)}function n(t){function n(e){return e.data}function a(e){console.log("XHR Failed PUT for TYPES! ERROR:"),console.log(e.data)}var s={method:"PUT",url:"api/api.php/types",data:t,headers:{"Content-Type":"application/json","Cache-Control":"no-cache"}};return console.log(t),e(s).then(n)["catch"](a)}var a={getTypes:t,updateTypes:n};return a}angular.module("prakli").factory("Types",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,n,a){function s(){a.get(o.user.username).then(function(e){if(e[0])if(e[0].password==o.user.password){delete e[0].password,t.putObject("user",e[0]),o.error={},o.user={};var a="/dashboard";if(t.get("redir")){var a=t.get("redir");t.remove("redir")}n.path(a)}else o.error.message="Incorrect Password!",o.user.password="";else o.error.message="No such user in the List!"})}function r(){}var o=this;o.user={},o.error={},o.authenticate=s,r()}angular.module("prakli").controller("LoginController",e),e.$inject=["$scope","$cookies","$location","Users"]}(),function(){"use strict";function e(e,t,n,a,s){function r(){}e.lng=n.lng,e.today=new Date,e.minDate=e.today,e.tag=e.lng.New+" - "+e.lng.Project,e.onlyWeekdays=function(e){var t=e.getDay();return t>0&&6>t},e.users=n.users,e.types=[],a.pr&&(e.tag=e.lng.EDIT,e.project=a.pr,e.project.duedate=new Date(e.project.duedate)),e.types=n.types,e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e)},r()}angular.module("prakli").controller("newProjectController",e),e.$inject=["$scope","$mdDialog","$rootScope","locals","Types"]}(),function(){"use strict";function e(e,t,n,a,s,r,o){function l(e){d.projectChart={options:{chart:{type:"pieChart",height:300,width:400,margin:{left:"10",right:"10"},x:function(e){return e.x},y:function(e){return e.y},showLabels:!0,duration:500,legend:{margin:{top:5,right:5,bottom:5,left:5}}}}},d.projectChart.data=[{x:"Open",y:e.open,color:"#023f88"},{x:"Closed",y:e.closed,color:"#388E3C"}]}function c(t){d.pending=[],d.pst=[],d.dst=[],d.cst=[],d.ast=[],d.closed=[],d.allTasks=[],angular.forEach(t,function(e,t){angular.forEach(e.tasks,function(t,n){if(t.responsible==d.currentuser.username||e.owner==d.currentuser.username)switch(t.projectid=e.id,d.allTasks.push(t),t.status){case"Pending":d.pending.push(t);break;case"P":d.pst.push(t);break;case"D":d.dst.push(t);break;case"C":d.cst.push(t);break;case"A":d.ast.push(t);break;case"Closed":d.closed.push(t)}})});var n={};n={pending:d.pending.length,p:d.pst.length,d:d.dst.length,c:d.cst.length,a:d.ast.length,closed:d.closed.length},d.taskChart={options:{chart:{type:"discreteBarChart",height:300,margin:{top:20,right:20,bottom:50,left:55},x:function(e){return e.label},y:function(e){return e.value},showValues:!0,valueFormat:function(e){return d3.format("")(e)},duration:500,xAxis:{axisLabel:e.lng.Status},yAxis:{axisLabel:e.lng.Tasks,axisLabelDistance:0}}},data:[{key:"Tasks",values:[{label:"Pending",value:n.pending,color:"#a8d8f8"},{label:"P",value:n.p,color:"#d8d8d8"},{label:"D",value:n.d,color:"#d8d8d8"},{label:"C",value:n.c,color:"#d8d8d8"},{label:"A",value:n.a,color:"#d8d8d8"},{label:"Closed",value:n.closed,color:"#d8f8a8"}]}]}}function i(e){s.show({controller:"newProjectController",templateUrl:"scripts/projects/newProject.html",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!1}).then(function(e){e.duedate=new Date(e.duedate).getTime(),e.tasks=[],e.owner=n.getObject("user").username,e.createdon=(new Date).getTime(),e.status=0,o.insert(e).then(function(e){r.projects.push(e),g={open:a("filter")(r.projects,{status:"!100"}).length,closed:a("filter")(r.projects,{status:100}).length},l(g),c(r.projects)})},function(){})}function u(){c(r.projects)}var d=this;d.currentuser=n.getObject("user"),d.projectChart={};var g={};d.pending=[],d.pst=[],d.dst=[],d.cst=[],d.ast=[],d.closed=[],d.allTasks=[],0==r.projects.length?o.getMyProjects(d.currentuser.username).then(function(e){g={open:a("filter")(e,{status:"!100",owner:d.currentuser.username}).length,closed:a("filter")(e,{status:100,owner:d.currentuser.username}).length},l(g),c(e)}):(g={open:a("filter")(r.projects,{status:"!100",owner:d.currentuser.username}).length,closed:a("filter")(r.projects,{status:100,owner:d.currentuser.username}).length},l(g),c(r.projects)),d.newProject=i,u()}angular.module("prakli").controller("DashboardController",e),e.$inject=["$scope","$window","$cookies","$filter","$mdDialog","$rootScope","Projects"]}(),function(){"use strict";function e(e,t,n,a,s,r,o,l,c,i){function u(){t.remove("user"),n.location.reload()}function d(e){s.show({controller:"newProjectController",templateUrl:"scripts/projects/newProject.html",parent:angular.element(document.body),targetEvent:e,locals:{},clickOutsideToClose:!1}).then(function(e){e.duedate=new Date(e.duedate).getTime(),e.tasks=[],e.owner=t.getObject("user").username,e.createdon=(new Date).getTime(),e.status=0,o.insert(e).then(function(e){r.projects.push(e)})},function(){})}function g(e){s.show({controller:"newMessageController",templateUrl:"scripts/messages/newMessage.html",parent:angular.element(document.body),targetEvent:e,locals:{},clickOutsideToClose:!1}).then(function(e){e.sender=t.getObject("user").username,e.senton=(new Date).getTime(),e.read=0,c.insert(e)},function(){})}function f(){return l.getList().then(function(e){return r.users=e,r.users})}function p(e){return o.getMyProjects(e).then(function(e){return r.projects=e,angular.forEach(r.projects,function(e,t){var n={P:25,D:50,C:75,A:100},a=100;angular.forEach(e.tasks,function(e,s){"Closed"!=e.status&&"Pending"!=e.status&&"Rejected"!=e.status?n[e.status]<a&&(a=n[e.status],r.projects[t].status=a):"Closed"==e.status&&100==a?(a=100,r.projects[t].status=100):("Pending"==e.status||"Rejected"==e.status)&&(a=0,r.projects[t].status=0)})}),r.projects})}function h(e){return c.getMyMessages(e).then(function(e){return r.messages=e,r.messages})}function m(){return i.getTypes().then(function(e){return r.types=e,r.types})}function k(){f(),p(j.user.username),h(j.user.username),m()}var j=this;j.user=t.getObject("user"),r.toggleSidenav=function(){a("left").toggle()},j.logout=u,j.newProject=d,j.newMessage=g,r.users=[],r.projects=[],r.messages=[],r.types=[],k()}angular.module("prakli").controller("UserController",e),e.$inject=["$scope","$cookies","$window","$mdSidenav","$mdDialog","$rootScope","Projects","Users","Messages","Types"]}(),function(){"use strict";function e(e,t,n,a,s){function r(){var e=[],t=s("filter")(a.projects,{owner:"!"+c.currentuser.username});return angular.forEach(t,function(n,a){var r=s("filter")(n.tasks,{responsible:c.currentuser.username});r&&-1==e.indexOf(t)&&n.attendees&&-1==n.attendees.indexOf(c.currentuser.username)&&e.push(n)}),e}function o(){var e=[];return angular.forEach(a.projects,function(t,n){t.attendees&&t.attendees.indexOf(c.currentuser.username)>-1&&e.push(t)}),e}function l(){}var c=this;c.currentuser=t.getObject("user"),c.participant=r,c.viewer=o,l()}angular.module("prakli").controller("ProjectsController",e),e.$inject=["$scope","$cookies","Projects","$rootScope","$filter"]}(),function(){"use strict";function e(e,t,n,a,s,r,o,l,c,i){function u(e){return a.getProject(e).then(function(e){return j.pr=e[0],f(),j.pr})}function d(e){var t="";return"Pending"==e.status?t="default":new Date(e.duedate)<new Date?t="Late":new Date(e.duedate)>new Date&&new Date(e.duedate)<=new Date((new Date).getTime()+1728e5)?t="Soon":(e.closedon||new Date(e.duedate)>new Date((new Date).getTime()+1728e5))&&(t="Ontime"),j.st[t]}function g(){j.act.active?j.act={}:j.act={active:1}}function f(){j.projectChart={options:{chart:{type:"multiBarHorizontalChart",height:400,x:function(e){return e.label},y:function(e){return e.value},showControls:!1,showValues:!0,duration:500,stacked:!0,xAxis:{axisLabel:e.lng.status,showMaxMin:!1},yAxis:{axisLabel:e.lng.count,tickFormat:function(e){return d3.format("d")(e)}},valueFormat:function(e){return d3.format("d")(e)}},title:{enable:!0,text:"Status summary for project Tasks"}},data:j.chartData()}}function p(){var t=[],n=[0,0,0,0,0,0],a=[0,0,0,0,0,0],s=[0,0,0,0,0,0];return angular.forEach(j.pr.tasks,function(e,t){if(1==e.active)if(new Date(e.duedate)<new Date)switch(e.status){case"Pending":n[0]=n[0]+1;break;case"P":n[1]=n[1]+1;break;case"D":n[2]=n[2]+1;break;case"C":n[3]=n[3]+1;break;case"A":n[4]=n[4]+1;break;case"Closed":n[5]=n[5]+1}else if(new Date(e.duedate)>new Date&&new Date(e.duedate)<=new Date((new Date).getTime()+1728e5))switch(e.status){case"Pending":a[0]=a[0]+1;break;case"P":a[1]=a[1]+1;break;case"D":a[2]=a[2]+1;break;case"C":a[3]=a[3]+1;break;case"A":a[4]=a[4]+1;break;case"Closed":a[5]=a[5]+1}else if(new Date(e.duedate)>new Date((new Date).getTime()+1728e5))switch(e.status){case"Pending":s[0]=s[0]+1;break;case"P":s[1]=s[1]+1;break;case"D":s[2]=s[2]+1;break;case"C":s[3]=s[3]+1;break;case"A":s[4]=s[4]+1;break;case"Closed":s[5]=s[5]+1}}),t=[{key:e.lng.Late,color:"#c9302c",values:[{label:e.lng.Pending,value:n[0]},{label:e.lng.P,value:n[1]},{label:e.lng.D,value:n[2]},{label:e.lng.C,value:n[3]},{label:e.lng.A,value:n[4]},{label:e.lng.Closed,value:n[5]}]},{key:e.lng.Comming,color:"#ec971f",values:[{label:e.lng.Pending,value:a[0]},{label:e.lng.P,value:a[1]},{label:e.lng.D,value:a[2]},{label:e.lng.C,value:a[3]},{label:e.lng.A,value:a[4]},{label:e.lng.Closed,value:a[5]}]},{key:e.lng.OnTime,color:"#449d44",values:[{label:e.lng.Pending,value:s[0]},{label:e.lng.P,value:s[1]},{label:e.lng.D,value:s[2]},{label:e.lng.C,value:s[3]},{label:e.lng.A,value:s[4]},{label:e.lng.Closed,value:s[5]}]}]}function h(e){s.show({controller:"newTaskController",templateUrl:"scripts/tasks/newTask.html",parent:angular.element(document.body),targetEvent:e,locals:{},clickOutsideToClose:!1}).then(function(e){e.duedate=new Date(e.duedate).getTime(),e.createdon=(new Date).getTime(),e.status="Pending",e.id=l("filter")(j.pr.tasks,{active:1}).length,e.version=1,e.active=1;var t={};t.title=o.lng.New+" "+o.lng.Task+" "+o.lng.Assigned,t.recipient=e.responsible,t.sender=j.pr.owner,t.senton=(new Date).getTime(),t.taskreference=e.id,t.text=e.id+". "+o.lng.Task+"\n\n Probléma: "+e.problem+"\n\n Akció: "+e.action,t.read=0,i.insert(t),j.pr.tasks.push(e),a.addTask(j.pr).then(function(e){angular.forEach(o.projects,function(t,n){t.id==e.id&&(o.projects[n]=e,f())})},function(){})})}function m(e,t){s.show({controller:"newProjectController",templateUrl:"scripts/projects/newProject.html",locals:{pr:t},clickOutsideToClose:!1}).then(function(e){e.duedate=new Date(e.duedate).getTime(),angular.forEach(e.tasks,function(t,n){t.title=e.title}),a.save(e).then(function(e){n.go(n.current,{},{reload:!0})})})}function k(){u(t.projectID)}var j=this;j.currentuser=c.getObject("user"),j.pr={},j.setStatus=d,j.st={Late:"red",Soon:"yellow",Ontime:"green"},j.act={active:1},j.showOnlyActive=g,j.projectChart={},j.chartData=p,k(),j.newTask=h,j.taskStatuses={Pending:0,P:25,D:50,C:75,A:100,Closed:100},j.editProject=m}angular.module("prakli").controller("SingleProjectController",e),e.$inject=["$scope","$stateParams","$state","Projects","$mdDialog","$mdMedia","$rootScope","$filter","$cookies","Messages"]}(),function(){"use strict";function e(e,t,n,a,s){function r(e){angular.forEach(e,function(e,t){angular.forEach(e.tasks,function(t,n){(t.responsible==l.currentuser.username||e.owner==l.currentuser.username)&&(t.projectid=e.id,new Date(t.duedate)<new Date?t.timer="Late":new Date(t.duedate)>new Date&&new Date(t.duedate)<=new Date((new Date).getTime()+1728e5)?t.timer="Soon":t.timer="Ontime",l.tasks.push(t))})})}function o(){}var l=this;l.currentuser=t.getObject("user"),l.tasks=[],0==n.projects.length?s.getMyProjects(l.currentuser.username).then(function(e){r(e)},function(){}):r(n.projects),l.taskStatuses={Pending:0,P:25,D:50,C:75,A:100,Closed:100},l.st={Late:"red",Soon:"yellow",Ontime:"green"},o()}angular.module("prakli").controller("tasksController",e),e.$inject=["$scope","$cookies","$rootScope","$filter","Projects"]}(),function(){"use strict";function e(e,t,n,a,s,r){function o(){}e.lng=n.lng,e.users=n.users,e.projects=n.projects,e.tag=e.lng.New+" - "+e.lng.Task,e.thisProject=s("filter")(e.projects,{id:a.projectID})[0],e.today=new Date,e.minDate=e.today,e.onlyWeekdays=function(e){var t=e.getDay();return t>0&&6>t},e.newtask={},e.newtask.title=e.thisProject.title,e.maxDate=new Date(e.thisProject.duedate),e.affects=["FMEA","CP","SOP"],r._singleTask&&(e.tag=e.lng.EDIT,e.newtask=r._singleTask.task,e.newtask.duedate=new Date(e.newtask.duedate)),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e)},o()}angular.module("prakli").controller("newTaskController",e),e.$inject=["$scope","$mdDialog","$rootScope","$stateParams","$filter","locals"]}(),function(){"use strict";function e(e,t,n,a,s,r,o,l,c){function i(){"Pending"==h.task.status?h.timer="default":new Date(h.task.duedate)<new Date?h.timer="Late":new Date(h.task.duedate)>new Date&&new Date(h.task.duedate)<=new Date((new Date).getTime()+1728e5)?h.timer="Soon":(h.task.closedon||new Date(h.task.duedate)>new Date((new Date).getTime()+1728e5))&&(h.timer="Ontime")}function u(e){var t=e;if(h.currentuser.username==h.task.responsible)switch(t){case"Pending":t="P";break;case"P":t="D";break;case"D":t="C";break;case"C":t="A"}return h.currentuser.username==h.thisProject.owner&&"A"==t&&(t="Closed",h.task.closedon=(new Date).getTime()),i(),t}function d(e){angular.forEach(h.thisProject.tasks,function(e,t){if(e.id==h.task.id){if(h.defaultResponsible!=h.task.responsible&&"Rejected"==h.task.status&&(h.task.status="Pending"),"Pending"==h.task.status){var a={};a.title=n.lng.New+" "+n.lng.Task+" "+n.lng.Assigned,a.recipient=h.task.responsible,a.sender=h.thisProject.owner,a.senton=(new Date).getTime(),a.taskreference=h.task.id,a.text=h.task.id+". "+n.lng.Task+"\n\n Probléma:"+h.task.problem+"\n\n Akció:"+h.task.action,a.read=0,c.insert(a)}h.thisProject.tasks[t]=h.task}}),r.save(h.thisProject).then(function(e){o.go("home.singleProject",{projectID:e.id})})}function g(e,n){h.messageTitle="Reject "+n.title,l.show({controller:"newMessageController",templateUrl:"scripts/messages/newMessage.html",parent:angular.element(document.body),targetEvent:e,locals:{_singleTask:{task:n,thisProject:h.thisProject}},clickOutsideToClose:!1}).then(function(e){e.sender=t.getObject("user").username,e.senton=(new Date).getTime(),e.read=0,h.task.status="Rejected",h.save(h.thisProject),c.insert(e)},function(){})}function f(e,t){l.show({controller:"newTaskController",templateUrl:"scripts/tasks/newTask.html",parent:angular.element(document.body),targetEvent:e,locals:{_singleTask:{task:t}},clickOutsideToClose:!1}).then(function(e){e.duedate=new Date(e.duedate).getTime(),(h.defaultResponsible!=e.responsible||h.defaultDuedate!=e.duedate)&&(h.defaultResponsible!=e.responsible&&(t.status="Pending"),t.modified?t.modified.push({on:(new Date).getTime(),from:{duedate:h.defaultDuedate,status:h.defaultStatus,responsible:h.defaultResponsible}}):(t.modified=[],t.modified.push({on:(new Date).getTime(),from:{duedate:h.defaultDuedate,status:h.defaultStatus,responsible:h.defaultResponsible}}))),r.save(h.thisProject).then(function(e){o.go("home.singleProject",{projectID:e.id})})})}function p(){}var h=this;h.currentuser=t.getObject("user"),h.defaultStatus="",0==n.projects.length?r.getMyProjects(h.currentuser.username).then(function(e){n.projects=e,h.thisProject=s("filter")(n.projects,{id:a.projectID})[0],h.task=s("filter")(h.thisProject.tasks,{id:a.taskID,active:1})[0],h.defaultStatus=h.task.status,h.defaultResponsible=h.task.responsible,h.defaultDuedate=h.task.duedate,i()},function(e){}):(h.thisProject=s("filter")(n.projects,{id:a.projectID})[0],h.task=s("filter")(h.thisProject.tasks,{id:a.taskID,active:1})[0],h.defaultStatus=h.task.status,h.defaultResponsible=h.task.responsible,h.defaultDuedate=h.task.duedate,i()),h.advanceStatus=u,h.save=d,h.cancel=function(){h.task.status=h.defaultStatus,history.back()},h.statuses={Pending:0,P:25,D:50,C:75,A:100,Closed:100},h.st={Late:"red",Soon:"yellow",Ontime:"green"},p(),h.newMessage=g,h.edit=f}angular.module("prakli").controller("SingleTaskController",e),e.$inject=["$scope","$cookies","$rootScope","$stateParams","$filter","Projects","$state","$mdDialog","Messages"]}(),function(){"use strict";function e(e,t,n,a,s){function r(e){a["delete"](e).then(function(n){n.success?angular.forEach(t.messages,function(n,a){n.id==e&&t.messages.splice(a,1)}):console.log(n.error)})}function o(e,t){c.message=t,s.show({controller:"newMessageController",templateUrl:"scripts/messages/newMessage.html",parent:angular.element(document.body),targetEvent:e,locals:{message:t},clickOutsideToClose:!1}).then(function(e){e.sender=n.getObject("user").username,e.senton=(new Date).getTime(),e.read=0,a.insert(e)},function(){})}function l(){e.sortType="senton",e.sortReverse=!0}var c=this;c.currentuser=n.getObject("user"),l(),c.deleteMessage=r,c.replyMessage=o}angular.module("prakli").controller("MessagesController",e),e.$inject=["$scope","$rootScope","$cookies","Messages","$mdDialog"]}(),function(){"use strict";function e(e,t,n,a){function s(){}e.lng=n.lng,e.users=n.users,e.message={},a._singleTask&&(e.message.title=a._singleTask.task.title+" Projekt - "+a._singleTask.task.id+". "+e.lng.Task+" "+e.lng.Reject,e.message.taskreference=a._singleTask.task.id,e.message.recipient=a._singleTask.thisProject.owner),a.message&&(e.message.title=a.message.title,e.message.recipient=a.message.sender),e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e)},s()}angular.module("prakli").controller("newMessageController",e),e.$inject=["$scope","$mdDialog","$rootScope","locals"]}(),function(){"use strict";function e(e,t,n,a,s,r,o,l,c,i){function u(e){var t=0;return t=o("filter")(k.allprojects,{owner:e}).length}function d(e){var t=0;return angular.forEach(k.allprojects,function(n,a){t+=o("filter")(n.tasks,{responsible:e}).length}),t}function g(){angular.forEach(n.types,function(e,t){""==e&&n.types.splice(t,1)}),i.updateTypes(n.types).then(function(e){console.log(e[0].success)})}function f(){k.currentuser.password=k.newpass,s.update(k.currentuser).then(function(e){k.message=e[0].success,k.newpass="",k.newpass2="",l(function(){k.message=""},2e3)})}function p(){var e=k.currentuser.defaultlang;c.getLanguage(e).then(function(e){n.lng=e}),k.currentuser.defaultlang=e,r.putObject("user",k.currentuser)}function h(){var e=r.getObject("user");s.update(e).then(function(e){k.message=e[0].success,l(function(){k.message=""},2e3)})}function m(){}var k=this;k.currentuser=r.getObject("user"),m(),k.allprojects=[],t.get("api/projects.json").then(function(e){k.allprojects=e.data}),k.projectCount=u,k.taskCount=d,k.saveTypes=g,k.saveNewPass=f,k.changeLanguage=p,k.saveUsersettings=h}angular.module("prakli").controller("SettingsController",e),e.$inject=["$scope","$http","$rootScope","Projects","Users","$cookies","$filter","$timeout","lng","Types"]}();